#+AUTHOR: Панков Вася
#+TEACHER: У. С. Опалева
#+TITLE: 02.02. Инструментальные средства разработки

* Лабораторная работа №5-6


Тема: Разработка и интеграция модулей проекта. Отладка отдельных модулей ПП. Организация обработки исключений.

1. Открыть в VS проект, созданный по шаблону Bottle в п.1-6 предыдущей ЛР.
   Вызвать окно свойств отладки либо так, как предложено в разделе теоретических сведений, либо как показано на скриншоте ниже:

   #+CAPTION: Окно свойств отладки
   [[file:images/2023-04-12_09-41-37_screenshot.png]]

2. В открывшемся окне свойств отладки с помощью всплывающих подсказок изучить
   описания параметров и те их значения, которые заданы по умолчанию. Результаты внести в отчёт.

   - Sript path - путь для запускаемого файла

   - Parameters - параметры запуска

   - Enviroment variables - переменнные среды

     - PYTHONUNBUFFERED

     - SERVER_HOST - переменнная, среды, которая берётся в нашей программе,
       для определения ip адреса, где будет запущена программа

     - SERVER_PORT - переменнная, среды, которая берётся в нашей программе,
       для определения номера порта, который будет прослушивать наша программа

   - Python interpreter - выбор интерпритатора python

   - Interpreter options - параметры запуска для интерпретатора

   - Working directory - рабочая папка

   - Content root – Это коллекция файлов, из которых можно импортировать модули

   - Source root – Директория, в которой хранятся ресурсы.

   - Галочки, означают, добавление Специального параметра – PYTHONPATH, при вызове

   - Emulate terminal - эмуляция терминала

   - Run with Python Console – вывод внешней питоновской консоли

   - Redirect input – позволяет указать файл, из которого будет браться программный ввод

   - Before launch – позволяет перед запуском конфигурации запустить браузер, внешний инструмент или даже другую конфигурацию
3. Установить фиксированный номер порта, например, 443:
   #+CAPTION: Установил переменные среды
   [[file:images/2023-04-12_09-55-16_screenshot.png]]

   #+CAPTION: После изменения порта
   [[file:images/2023-04-12_09-56-02_screenshot.png]]

   #+CAPTION: Изменённый порт в браузере
   [[file:images/2023-04-12_09-58-11_screenshot.png]]

   #+CAPTION: Порт по умолчанию
   [[file:images/2023-04-12_09-57-31_screenshot.png]]
4. Добавить на главную страницу сайта простейшую форму обратной связи, состоящую из текстовой области, текстового поля и кнопки.

   Выяснить, что означают атрибуты HTML-тэгов, сделать размер textarea неизменяемым.
   - action – Какую функцию апи выполнить

   - method – Какой http-метод используется(get, post, put)

   - rows, cols - Кол-во рядов и колонок текста

   - name – указывает имя для элемента html

   - plaseholder – текст-подсказка

   - type – у тэга input позволяет выбрать конкретный элемент формы(checkbox, date, file и тд)

   - value – значение которое пишется внутри тэга

   #+CAPTION: Textarea неизменяемый по содержанию и по размеру
   [[file:images/2023-04-12_10-01-19_screenshot.png]]

   #+CAPTION: Итоговая форма
   [[file:images/2023-04-12_10-02-56_screenshot.png]]

   Выполнить коммит изменений. Показать в отчёте историю коммитов.

   #+CAPTION: История коммитов
   [[file:images/2023-04-12_10-05-03_screenshot.png]]
5. Теперь необходимо добавить в папку проекта файл-обработчик для формы.

   #+CAPTION: Форма
   [[file:images/2023-04-12_10-07-45_screenshot.png]]

6. Тестирование формы

   #+CAPTION: Вставка email
   [[file:images/2023-04-12_10-08-25_screenshot.png]]

   #+CAPTION: Результат обработки формы
   [[file:images/2023-04-12_10-09-51_screenshot.png]]

7. Дописать в файл обработчик:

   1. Паттерн для адреса электронной почты (проверку на соответствие формату).

      #+CAPTION: Проверка почты на корректность
      [[file:images/2023-04-12_10-11-04_screenshot.png]]

   2. Обращение по имени в результирующем сообщении, например, «Thanks, Nik! …»,
      предварительно дописав необходимый элемент вёрстки «USERNAME» в шаблоне страницы.
      При тестировании вводить своё имя, набранное на латинице.

      Было добавлен получение поля username и добавление его в строку вывода:
      
      [[file:images/2023-04-12_10-17-27_screenshot.png]]
      [[file:images/2023-04-12_10-17-16_screenshot.png]]

   3. Дату обращения пользователя в сокращённом формате согласно текущей системной дате в конце результирующего сообщения, например, «… Access Date: 2023-02-22».

      Получаю сегодняшнее время с помощью datetime и получаю из этого времени дату:

      [[file:images/2023-04-12_10-18-37_screenshot.png]]
   
   4. Проверку заполненности полей формы (если хотя бы одно поле не заполнено выводить соответствующее сообщение).

      #+CAPTION: Добавлен required на каждое поле ввода
      [[file:images/2023-04-12_10-14-53_screenshot.png]]



Итоговый код формы:

#+begin_src python
import re

from bottle import post, request, view
from datetime import datetime


@post('/home', method='post')
@view("index")
def my_form():
    mail: str = request.forms.get('ADRESS')
    username: str = request.forms.get('USERNAME')
    if re.fullmatch(r"[a-zA-Z0-9._]{1,256}@[a-zA-Z0-9]{1,100}\.[a-zA-Z0-9]{1,7}", mail) is None:
        return dict(
            year=datetime.now().year,
            message="Sorry, your email is incorrect."
        )
    return dict(
        year=datetime.now().year,
        message="Thanks %s! The answer will be sent to the mail %s<br>Access Date: %s" % (
            username, mail, datetime.now().date())
    )
#+end_src

​8. Выполнить тестирование исключительных ситуаций (поля не заполнены, Email не соответствует формату) и отладку кода. Закоммитеть изменения. Все результаты внести в отчёт.

Тестирование:
#+CAPTION: Поля не заполнены
[[file:images/2023-04-12_10-22-27_screenshot.png]]

#+CAPTION: Одно поле не заполнено
[[file:images/2023-04-12_10-23-09_screenshot.png]]

#+CAPTION: Корректное срабатывание
[[file:images/2023-04-12_10-23-44_screenshot.png]]

#+CAPTION: Некорректная почта
[[file:images/2023-04-12_10-24-31_screenshot.png]]



История коммитов:
#+CAPTION: Итоговая история коммитов

[[file:images/2023-04-12_10-19-58_screenshot.png]]


Контрольные вопросы:
1. Какие параметры включает группа «Отладка» вкладки «Веб-средство запуска»?
   
   Пути поиска, Аргументы сценария, Аргументы интерпретатора, Путь к
   Интерпретатору, URL-адрес для запуска, Номер порта, Команда, Аргументы, Среда
2. Какого рода исключительные ситуации вам известны? Привести 3-4 примера.
   Деление на ноль(ZeroDivisionError), Неправильное значение(ValueError), Несуществующее имя(NameError)
3. Как будет выглядеть регулярное выражение Python для проверки формата номера мобильного телефона +7 (ххх) ххх-хх-хх?
   Например, как: ~r“\+7 \([0-9]{3}\) [0-9]{3}-[0-9]{2}-[0-9]{2}”~
